import{g as n,f as s,j as a,l as t}from"./common-bec3f312.js";const o='{"title":"网站监控笔记（二） — 资源异常 🔨","frontmatter":{"date":"2021-01-31","title":"网站监控笔记（二） — 资源异常 🔨","tags":["监控","性能优化"],"describe":"什么是资源异常？简单点说就是对 图片，视频，音频，css，js，request 请求资源时出现异常，哪些异常呢？网络错误，资源不存在等。那我需要对错误资源进行监听定位，进行错误及时上报。"},"headers":[{"level":2,"title":"回顾","slug":"回顾"},{"level":2,"title":"前言","slug":"前言"},{"level":2,"title":"分类型","slug":"分类型"},{"level":2,"title":"静态图片，音、视频","slug":"静态图片，音、视频"},{"level":3,"title":"element.onerror","slug":"element-onerror"},{"level":3,"title":"window.addEventListener(\'error\')","slug":"window-addeventlistener-error"},{"level":2,"title":"静态js，css资源","slug":"静态js，css资源"},{"level":2,"title":"监听 request","slug":"监听-request"},{"level":3,"title":"window.addEventListener(\'unhandledrejection\')","slug":"window-addeventlistener-unhandledrejection"},{"level":3,"title":"兼容性","slug":"兼容性"},{"level":2,"title":"注解地址","slug":"注解地址"}],"relativePath":"docs/website-Monitoring2.md","lastUpdated":1631689037000}';var e={};const c=a("iframe",{frameborder:"no",border:"0",marginwidth:"0",marginheight:"0",width:"100%",height:"100",src:"//music.163.com/outchain/player?type=2&id=1401671455&auto=0&height=66"},null,-1),p=a("h2",{id:"回顾"},[a("a",{class:"header-anchor",href:"#回顾","aria-hidden":"true"},"#"),t(" 回顾")],-1),l=a("p",null,[t("我们在上一篇中讲到如何对于前端资源加载时间进行监控，主要的中以 "),a("code",null,"Performance"),t(" 为主。")],-1),u=a("h2",{id:"前言"},[a("a",{class:"header-anchor",href:"#前言","aria-hidden":"true"},"#"),t(" 前言")],-1),i=a("blockquote",null,[a("p",null,"什么是资源异常？简单点说就是对 图片，视频，音频，css，js，request 请求资源时出现异常，哪些异常呢？网络错误，资源不存在等。那我需要对错误资源进行监听定位，进行错误及时上报。")],-1),k=a("p",null,[a("img",{src:"/_assets/eefce9af528223b070300c8f0aac25b.f8b48535.png",alt:""})],-1),r=a("h2",{id:"分类型"},[a("a",{class:"header-anchor",href:"#分类型","aria-hidden":"true"},"#"),t(" 分类型")],-1),g=a("ol",null,[a("li",null,"静态图片，音、视频"),a("li",null,"静态js，css资源"),a("li",null,"请求异常或超时")],-1),d=a("p",null,"老严这篇文章准备将这些资源分为以上三个类型逐个进行讲解",-1),m=a("h2",{id:"静态图片，音、视频"},[a("a",{class:"header-anchor",href:"#静态图片，音、视频","aria-hidden":"true"},"#"),t(" 静态图片，音、视频")],-1),f=a("h3",{id:"element-onerror"},[a("a",{class:"header-anchor",href:"#element-onerror","aria-hidden":"true"},"#"),t(" element.onerror")],-1),h=a("p",null,[a("strong",null,"注意："),t(),a("code",null,"element.onerror"),t(" 与 "),a("code",null,"window.onerror"),t(" 是不同的,留个伏笔，后面老严会提上一嘴,也可以提前去"),a("a",{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers/onerror",target:"_blank",rel:"noopener noreferrer"},"MDN [0]")],-1),v=a("div",{class:"language-html"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"\x3c!-- 先来个正常 --\x3e"),t("\n"),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),t("img")]),t(),a("span",{class:"token attr-name"},"src"),a("span",{class:"token attr-value"},[a("span",{class:"token punctuation attr-equals"},"="),a("span",{class:"token punctuation"},'"'),t("https://star.kuwo.cn/star/starheads/300/1/27/2191880246.jpg"),a("span",{class:"token punctuation"},'"')]),t(),a("span",{class:"token punctuation"},"/>")]),t("\n"),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),t("script")]),a("span",{class:"token punctuation"},">")]),a("span",{class:"token script"},[a("span",{class:"token language-javascript"},[t("\n    document"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"getElementsByTagName"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'img'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"["),a("span",{class:"token number"},"0"),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"onerror"),t(),a("span",{class:"token operator"},"="),t(),a("span",{class:"token keyword"},"function"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"event"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"{"),t("\n        console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),t("event"),a("span",{class:"token punctuation"},")"),t("\n        console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"发生时间"'),a("span",{class:"token punctuation"},","),a("span",{class:"token keyword"},"new"),t(),a("span",{class:"token class-name"},"Date"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"getTime"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),t("\n    "),a("span",{class:"token punctuation"},"}"),t("\n")])]),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"</"),t("script")]),a("span",{class:"token punctuation"},">")]),t("\n")])])],-1),w=a("p",null,[t("效果 "),a("img",{src:"/_assets/1612078637(1).0ddc875a.jpg",alt:""}),t(" 控制台当然是干干净净咯！资源一切正常")],-1),j=a("p",null,[a("strong",null,"咱们换个错误的图片")],-1),y=a("div",{class:"language-html"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"\x3c!-- 来个不存在的图片资源 --\x3e"),t("\n"),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),t("img")]),t(),a("span",{class:"token attr-name"},"src"),a("span",{class:"token attr-value"},[a("span",{class:"token punctuation attr-equals"},"="),a("span",{class:"token punctuation"},'"'),t("./xxx.png"),a("span",{class:"token punctuation"},'"')]),t(),a("span",{class:"token punctuation"},"/>")]),t("\n"),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),t("script")]),a("span",{class:"token punctuation"},">")]),a("span",{class:"token script"},[a("span",{class:"token language-javascript"},[t("\n    document"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"getElementsByTagName"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'img'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"["),a("span",{class:"token number"},"0"),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"onerror"),t(),a("span",{class:"token operator"},"="),t(),a("span",{class:"token keyword"},"function"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"event"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"{"),t("\n        console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),t("event"),a("span",{class:"token punctuation"},")"),t("\n        console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"发生时间"'),a("span",{class:"token punctuation"},","),a("span",{class:"token keyword"},"new"),t(),a("span",{class:"token class-name"},"Date"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"getTime"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),t("\n    "),a("span",{class:"token punctuation"},"}"),t("\n")])]),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"</"),t("script")]),a("span",{class:"token punctuation"},">")]),t("\n")])])],-1),b=a("p",null,[t("效果 "),a("img",{src:"/_assets/1612078876(1).81a063c2.jpg",alt:""}),t(" 我们现在已经看到了 "),a("code",null,"event"),t(" 的打印,里面有哪些东西是可用的呢？")],-1),E=a("div",{class:"language-html"},[a("pre",null,[a("code",null,[a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),t("img")]),t(),a("span",{class:"token attr-name"},"src"),a("span",{class:"token attr-value"},[a("span",{class:"token punctuation attr-equals"},"="),a("span",{class:"token punctuation"},'"'),t("./xxx.png"),a("span",{class:"token punctuation"},'"')]),t(),a("span",{class:"token punctuation"},"/>")]),t("\n"),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),t("script")]),a("span",{class:"token punctuation"},">")]),a("span",{class:"token script"},[a("span",{class:"token language-javascript"},[t("\n    document"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"getElementsByTagName"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'img'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"["),a("span",{class:"token number"},"0"),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"onerror"),t(),a("span",{class:"token operator"},"="),t(),a("span",{class:"token keyword"},"function"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"event"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"{"),t("\n        console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"发生时间"'),a("span",{class:"token punctuation"},","),a("span",{class:"token keyword"},"new"),t(),a("span",{class:"token class-name"},"Date"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"getTime"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),t("\n        "),a("span",{class:"token comment"},"// 错误资源地址"),t("\n        console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'src:'"),t(),a("span",{class:"token operator"},"+"),t(" event"),a("span",{class:"token punctuation"},"."),t("srcElement"),a("span",{class:"token punctuation"},"."),t("src"),a("span",{class:"token punctuation"},")"),t("\n        "),a("span",{class:"token comment"},"// 标签"),t("\n        console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'tagName:'"),t(),a("span",{class:"token operator"},"+"),t(" event"),a("span",{class:"token punctuation"},"."),t("srcElement"),a("span",{class:"token punctuation"},"."),t("tagName"),a("span",{class:"token punctuation"},")"),t("\n        "),a("span",{class:"token comment"},"// 在这里我们就可以进行错误上报，紧急告知"),t("\n    "),a("span",{class:"token punctuation"},"}"),t("\n")])]),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"</"),t("script")]),a("span",{class:"token punctuation"},">")]),t("\n")])])],-1),x=a("p",null,[t("效果： "),a("img",{src:"/_assets/1612079552.8817e0ff.jpg",alt:""})],-1),q=a("p",null,"图片示例我们就已经可以看到了，当然这只是简单的一个例子，就这几行代码即可完成。 我们的页面肯定不止有图片资源，音频视频也是一样的操作，我们可以进行简单的封装一下",-1),N=a("div",{class:"language-html"},[a("pre",null,[a("code",null,[a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),t("img")]),t(),a("span",{class:"token attr-name"},"src"),a("span",{class:"token attr-value"},[a("span",{class:"token punctuation attr-equals"},"="),a("span",{class:"token punctuation"},'"'),t("xxx.jpg"),a("span",{class:"token punctuation"},'"')]),t(),a("span",{class:"token punctuation"},"/>")]),t("\n"),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),t("video")]),t(),a("span",{class:"token attr-name"},"src"),a("span",{class:"token attr-value"},[a("span",{class:"token punctuation attr-equals"},"="),a("span",{class:"token punctuation"},'"'),t("xxx.mp4"),a("span",{class:"token punctuation"},'"')]),a("span",{class:"token punctuation"},">")]),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"</"),t("video")]),a("span",{class:"token punctuation"},">")]),t("\n"),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),t("audio")]),t(),a("span",{class:"token attr-name"},"src"),a("span",{class:"token attr-value"},[a("span",{class:"token punctuation attr-equals"},"="),a("span",{class:"token punctuation"},'"'),t("xxx.mp3"),a("span",{class:"token punctuation"},'"')]),a("span",{class:"token punctuation"},">")]),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"</"),t("audio")]),a("span",{class:"token punctuation"},">")]),t("\n"),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),t("script")]),a("span",{class:"token punctuation"},">")]),a("span",{class:"token script"},[a("span",{class:"token language-javascript"},[t("\n    "),a("span",{class:"token keyword"},"let"),t(" elementArray "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token punctuation"},"["),a("span",{class:"token punctuation"},"]"),t("\n    "),a("span",{class:"token keyword"},"function"),t(),a("span",{class:"token function"},"returnElement"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"el"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"{"),t("\n        "),a("span",{class:"token keyword"},"let"),t(" gather "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token punctuation"},"["),a("span",{class:"token punctuation"},"]"),t("\n        "),a("span",{class:"token keyword"},"for"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"let"),t(" i "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token number"},"0"),a("span",{class:"token punctuation"},";"),t(" i "),a("span",{class:"token operator"},"<"),t(" el"),a("span",{class:"token punctuation"},"."),t("length"),a("span",{class:"token punctuation"},";"),t(" i"),a("span",{class:"token operator"},"++"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"{"),t("\n            gather"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"push"),a("span",{class:"token punctuation"},"("),a("span",{class:"token operator"},"..."),t("document"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"querySelectorAll"),a("span",{class:"token punctuation"},"("),t("el"),a("span",{class:"token punctuation"},"["),t("i"),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),t("\n        "),a("span",{class:"token punctuation"},"}"),t("\n        "),a("span",{class:"token keyword"},"return"),t(" gather\n    "),a("span",{class:"token punctuation"},"}"),t("\n    elementArray "),a("span",{class:"token operator"},"="),t(),a("span",{class:"token function"},"returnElement"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"["),a("span",{class:"token string"},"'img'"),a("span",{class:"token punctuation"},","),t(),a("span",{class:"token string"},"'video'"),a("span",{class:"token punctuation"},","),t(),a("span",{class:"token string"},"'audio'"),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},")"),t("\n    elementArray"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"forEach"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"item"),a("span",{class:"token operator"},"=>"),a("span",{class:"token punctuation"},"{"),t("\n        item"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"onerror"),t(),a("span",{class:"token operator"},"="),t(),a("span",{class:"token keyword"},"function"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"event"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"{"),t("\n            console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"发生时间"'),a("span",{class:"token punctuation"},","),a("span",{class:"token keyword"},"new"),t(),a("span",{class:"token class-name"},"Date"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"getTime"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),t("\n            console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"table"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),t("tagName"),a("span",{class:"token operator"},":"),t(" event"),a("span",{class:"token punctuation"},"."),t("srcElement"),a("span",{class:"token punctuation"},"."),t("tagName "),a("span",{class:"token punctuation"},","),t(" src"),a("span",{class:"token operator"},":"),t(" event"),a("span",{class:"token punctuation"},"."),t("srcElement"),a("span",{class:"token punctuation"},"."),t("src"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),t("\n        "),a("span",{class:"token punctuation"},"}"),t("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),t("\n")])]),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"</"),t("script")]),a("span",{class:"token punctuation"},">")]),t("\n")])])],-1),_=a("p",null,[t("效果： "),a("img",{src:"/_assets/1612081904(1).ef01a376.jpg",alt:""}),t(" 你以为这就完了？")],-1),L=a("h3",{id:"window-addeventlistener-error"},[a("a",{class:"header-anchor",href:"#window-addeventlistener-error","aria-hidden":"true"},"#"),t(" window.addEventListener('error')")],-1),P=a("p",null,[t("也可以使用 "),a("code",null,"window.addEventListener('error')")],-1),T=a("div",{class:"language-html"},[a("pre",null,[a("code",null,[a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),t("img")]),t(),a("span",{class:"token attr-name"},"src"),a("span",{class:"token attr-value"},[a("span",{class:"token punctuation attr-equals"},"="),a("span",{class:"token punctuation"},'"'),t("xxx.jpg"),a("span",{class:"token punctuation"},'"')]),t(),a("span",{class:"token punctuation"},"/>")]),t("\n"),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),t("script")]),a("span",{class:"token punctuation"},">")]),a("span",{class:"token script"},[a("span",{class:"token language-javascript"},[t("\n    window"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"addEventListener"),a("span",{class:"token punctuation"},"("),t("\n        "),a("span",{class:"token string"},'"error"'),a("span",{class:"token punctuation"},","),t("\n        "),a("span",{class:"token parameter"},"e"),t(),a("span",{class:"token operator"},"=>"),t(),a("span",{class:"token punctuation"},"{"),t("\n            e"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"stopImmediatePropagation"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n            "),a("span",{class:"token keyword"},"if"),t(),a("span",{class:"token punctuation"},"("),t("e"),a("span",{class:"token punctuation"},"."),t("srcElement "),a("span",{class:"token operator"},"==="),t(" window"),a("span",{class:"token punctuation"},")"),t(),a("span",{class:"token punctuation"},"{"),t("\n                "),a("span",{class:"token comment"},"// 全局错误"),t("\n                console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"全局错误"'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n                console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"message"'),a("span",{class:"token punctuation"},","),t(" e"),a("span",{class:"token punctuation"},"."),t("message"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n            "),a("span",{class:"token punctuation"},"}"),t(),a("span",{class:"token keyword"},"else"),t(),a("span",{class:"token punctuation"},"{"),t("\n                "),a("span",{class:"token comment"},"// 元素错误，比如引用资源报错"),t("\n                console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"元素错误"'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n                console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"tagname"'),a("span",{class:"token punctuation"},","),t(" e"),a("span",{class:"token punctuation"},"."),t("srcElement"),a("span",{class:"token punctuation"},"."),t("tagName"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n                console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"src"'),a("span",{class:"token punctuation"},","),t(" e"),a("span",{class:"token punctuation"},"."),t("srcElement"),a("span",{class:"token punctuation"},"."),t("src"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n            "),a("span",{class:"token punctuation"},"}"),t("\n            console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"发生时间"'),a("span",{class:"token punctuation"},","),a("span",{class:"token keyword"},"new"),t(),a("span",{class:"token class-name"},"Date"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"getTime"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),t("\n            console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"onerror捕获网络请求错误"'),a("span",{class:"token punctuation"},","),t(" e"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t(),a("span",{class:"token comment"},"// 捕获错误"),t("\n        "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),t("\n        "),a("span",{class:"token boolean"},"true"),t(" \n    "),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n")])]),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"</"),t("script")]),a("span",{class:"token punctuation"},">")]),t("\n")])])],-1),A=a("p",null,[t("效果： "),a("img",{src:"/_assets/1612082032(1).89480adb.jpg",alt:""}),t(" 音视频同理")],-1),D=a("h2",{id:"静态js，css资源"},[a("a",{class:"header-anchor",href:"#静态js，css资源","aria-hidden":"true"},"#"),t(" 静态js，css资源")],-1),z=a("p",null,[t("一样的可以采用 "),a("code",null,"window.addEventListener('error')"),t(",不过需要放到js资源之上")],-1),I=a("div",{class:"language-html"},[a("pre",null,[a("code",null,[a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),t("script")]),a("span",{class:"token punctuation"},">")]),a("span",{class:"token script"},[a("span",{class:"token language-javascript"},[t("\n  window"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"addEventListener"),a("span",{class:"token punctuation"},"("),t("\n      "),a("span",{class:"token string"},'"error"'),a("span",{class:"token punctuation"},","),t("\n      "),a("span",{class:"token parameter"},"e"),t(),a("span",{class:"token operator"},"=>"),t(),a("span",{class:"token punctuation"},"{"),t("\n          e"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"stopImmediatePropagation"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n          "),a("span",{class:"token keyword"},"if"),t(),a("span",{class:"token punctuation"},"("),t("e"),a("span",{class:"token punctuation"},"."),t("srcElement "),a("span",{class:"token operator"},"==="),t(" window"),a("span",{class:"token punctuation"},")"),t(),a("span",{class:"token punctuation"},"{"),t("\n              "),a("span",{class:"token comment"},"// 全局错误"),t("\n              console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"全局错误"'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n              console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"message"'),a("span",{class:"token punctuation"},","),t(" e"),a("span",{class:"token punctuation"},"."),t("message"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n          "),a("span",{class:"token punctuation"},"}"),t(),a("span",{class:"token keyword"},"else"),t(),a("span",{class:"token punctuation"},"{"),t("\n              "),a("span",{class:"token comment"},"// 元素错误，比如引用资源报错"),t("\n              console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"元素错误"'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n              console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"tagname"'),a("span",{class:"token punctuation"},","),t(" e"),a("span",{class:"token punctuation"},"."),t("srcElement"),a("span",{class:"token punctuation"},"."),t("tagName"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n              console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"src"'),a("span",{class:"token punctuation"},","),t(" e"),a("span",{class:"token punctuation"},"."),t("srcElement"),a("span",{class:"token punctuation"},"."),t("src"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n          "),a("span",{class:"token punctuation"},"}"),t("\n          console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"发生时间"'),a("span",{class:"token punctuation"},","),a("span",{class:"token keyword"},"new"),t(),a("span",{class:"token class-name"},"Date"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"getTime"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),t("\n          console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"onerror捕获网络请求错误"'),a("span",{class:"token punctuation"},","),t(" e"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t(),a("span",{class:"token comment"},"// 捕获错误"),t("\n      "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),t("\n      "),a("span",{class:"token boolean"},"true"),t(" \n  "),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n")])]),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"</"),t("script")]),a("span",{class:"token punctuation"},">")]),t("\n"),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),t("script")]),t(),a("span",{class:"token attr-name"},"src"),a("span",{class:"token attr-value"},[a("span",{class:"token punctuation attr-equals"},"="),a("span",{class:"token punctuation"},'"'),t("//baidu.com/test.js"),a("span",{class:"token punctuation"},'"')]),a("span",{class:"token punctuation"},">")]),a("span",{class:"token script"}),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"</"),t("script")]),a("span",{class:"token punctuation"},">")]),t("\n")])])],-1),H=a("p",null,[a("img",{src:"/_assets/1612082872(1).42d4019a.jpg",alt:""})],-1),B=a("p",null,[a("strong",null,"监听 css 资源")],-1),C=a("div",{class:"language-diff"},[a("pre",null,[a("code",null,[a("span",{class:"token inserted-sign inserted"},[a("span",{class:"token prefix inserted"},"+"),a("span",{class:"token line"},'   console.log("src", e.srcElement.href || e.srcElement.src);\n')]),a("span",{class:"token deleted-sign deleted"},[a("span",{class:"token prefix deleted"},"-"),a("span",{class:"token line"},'   console.log("src", e.srcElement.src);\n')])])])],-1),G=a("p",null,[t("将上面的 "),a("code",null,'console.log("src", e.srcElement.src);'),t(" 修改一下即可 效果 "),a("img",{src:"/_assets/1612094071(1).81c4f164.jpg",alt:""})],-1),W=a("h2",{id:"监听-request"},[a("a",{class:"header-anchor",href:"#监听-request","aria-hidden":"true"},"#"),t(" 监听 request")],-1),M=a("h3",{id:"window-addeventlistener-unhandledrejection"},[a("a",{class:"header-anchor",href:"#window-addeventlistener-unhandledrejection","aria-hidden":"true"},"#"),t(" window.addEventListener('unhandledrejection')")],-1),F=a("p",null,[a("strong",null,"Promise")],-1),S=a("div",{class:"language-js"},[a("pre",null,[a("code",null,[t("window"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"addEventListener"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'unhandledrejection'"),a("span",{class:"token punctuation"},","),t(),a("span",{class:"token parameter"},"event"),t(),a("span",{class:"token operator"},"=>"),a("span",{class:"token punctuation"},"{"),t("\n    "),a("span",{class:"token comment"},"// event "),t("\n    console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),t("event"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t(" \n    "),a("span",{class:"token comment"},"// 异常 promise"),t("\n    console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),t("event"),a("span",{class:"token punctuation"},"."),t("promise"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t(" \n    "),a("span",{class:"token comment"},"// 错误信息"),t("\n    console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),t("event"),a("span",{class:"token punctuation"},"."),t("reason"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t(" \n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n\n"),a("span",{class:"token keyword"},"function"),t(),a("span",{class:"token function"},"test"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"{"),t("\n   Promise"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"reject"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'Hello, Fun debug!'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n"),a("span",{class:"token punctuation"},"}"),t("\n\n"),a("span",{class:"token function"},"test"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n")])])],-1),U=a("p",null,[a("img",{src:"/_assets/1612098290(1).33b196eb.jpg",alt:""})],-1),J=a("p",null,[a("strong",null,"fetch")],-1),K=a("div",{class:"language-js"},[a("pre",null,[a("code",null,[t("window"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"addEventListener"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"unhandledrejection"'),a("span",{class:"token punctuation"},","),t(),a("span",{class:"token keyword"},"function"),t(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"e"),a("span",{class:"token punctuation"},")"),t(),a("span",{class:"token punctuation"},"{"),t("\n    console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'unhandledrejection'"),a("span",{class:"token punctuation"},")"),t("\n    console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),t("e"),a("span",{class:"token punctuation"},")"),t("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),t(),a("span",{class:"token boolean"},"true"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n"),a("span",{class:"token comment"},"// 请求返回错误"),t("\n"),a("span",{class:"token function"},"fetch"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'http://example.com/movies.json'"),a("span",{class:"token punctuation"},")"),t("\n    "),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"then"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"function"),t(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"res"),a("span",{class:"token punctuation"},")"),t(),a("span",{class:"token punctuation"},"{"),t("\n        "),a("span",{class:"token keyword"},"return"),t(" res"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"json"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),t("\n    "),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"then"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"function"),t(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"data"),a("span",{class:"token punctuation"},")"),t(),a("span",{class:"token punctuation"},"{"),t("\n        console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),t("data"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n"),a("span",{class:"token comment"},"// 无效请求"),t("\n"),a("span",{class:"token function"},"fetch"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'http://example.com/404.json'"),a("span",{class:"token punctuation"},")"),t("\n    "),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"then"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"function"),t(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"res"),a("span",{class:"token punctuation"},")"),t(),a("span",{class:"token punctuation"},"{"),t("\n        "),a("span",{class:"token keyword"},"return"),t(" res"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"json"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),t("\n    "),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"then"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"function"),t(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"data"),a("span",{class:"token punctuation"},")"),t(),a("span",{class:"token punctuation"},"{"),t("\n        console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),t("data"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),t("\n")])])],-1),O=a("p",null,[a("img",{src:"/_assets/1612097970(1).8865d2d0.jpg",alt:""})],-1),Q=a("h3",{id:"兼容性"},[a("a",{class:"header-anchor",href:"#兼容性","aria-hidden":"true"},"#"),t(" 兼容性")],-1),R=a("p",null,[t("unhandledrejection 的兼容性 "),a("img",{src:"/_assets/1612098393(1).13a21a81.jpg",alt:""})],-1),V=a("p",null,"下集我们会讲到捕捉异常",-1),X=a("h2",{id:"注解地址"},[a("a",{class:"header-anchor",href:"#注解地址","aria-hidden":"true"},"#"),t(" 注解地址")],-1),Y=a("p",null,[t("[0] "),a("a",{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers/onerror",target:"_blank",rel:"noopener noreferrer"},"https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers/onerror")],-1);e.render=function(a,t,o,e,Z,$){return s(),n("div",null,[c,p,l,u,i,k,r,g,d,m,f,h,v,w,j,y,b,E,x,q,N,_,L,P,T,A,D,z,I,H,B,C,G,W,M,F,S,U,J,K,O,Q,R,V,X,Y])};export default e;export{o as __pageData};
